{"version":3,"sources":["../../../lib/routes/tbs.js"],"names":["Object","defineProperty","exports","value","_express","require","_express2","_interopRequireDefault","_axios","_axios2","_beerStoreParser","_beerStoreParser2","_dbOps","obj","__esModule","default","router","Router","beerStore","get","req","res","console","log","dbConnection","dbInterface","then","resp","send","catch","err","next","params","brand","store","bsParse","data","results","parseInventory","beerIDs","inventoryArray","beerId","all","keys","map","id","spread","_len","arguments","length","inventory","Array","_key","responseObject","scrapeResult","push","stores","PHA","SNPA","NHA","beers","labels","arr","_loop","i","aggr","location","storeid","_len2","_key2","n","JSON","parse","config"],"mappings":"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","file":"tbs.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _express = require('express');\n\nvar _express2 = _interopRequireDefault(_express);\n\nvar _axios = require('axios');\n\nvar _axios2 = _interopRequireDefault(_axios);\n\nvar _beerStoreParser = require('../utils/beerStoreParser');\n\nvar _beerStoreParser2 = _interopRequireDefault(_beerStoreParser);\n\nvar _dbOps = require('../utils/dbOps');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar router = _express2.default.Router();\nvar beerStore = 'http://www.thebeerstore.ca/beers/inventory';\n\nrouter.get('/stores', function (req, res) {\n    console.log(\"Requested Stores Resource\");\n    var dbConnection = new _dbOps.dbInterface('TBS_Store');\n    dbConnection.get().then(function (resp) {\n        res.send(resp);\n    }).catch(function (err) {\n        console.log(\"Error\");\n    });\n});\n\nrouter.get('/inv/:store/:brand', function (req, res, next) {\n    _axios2.default.get(beerStore + '/' + req.params.brand + '/' + req.params.store).then(function (resp) {\n        var bsParse = new _beerStoreParser2.default(resp.data, function (results) {\n            res.send(results);\n        });\n        bsParse.parseInventory();\n    });\n});\n\nrouter.get('/inv/:store', function (req, res, next) {\n    var beerIDs = {\n        4111: \"PHA\",\n        4112: \"SNPA\",\n        4115: \"NHA\"\n    };\n    var inventoryArray = [];\n    var beerId = 0;\n    _axios2.default.all(Object.keys(beerIDs).map(function (id) {\n        return _axios2.default.get(beerStore + '/' + id + '/' + req.params.store);\n    })).then(_axios2.default.spread(function () {\n        for (var _len = arguments.length, inventory = Array(_len), _key = 0; _key < _len; _key++) {\n            inventory[_key] = arguments[_key];\n        }\n\n        inventory.map(function (responseObject) {\n            new _beerStoreParser2.default(responseObject.data, function (scrapeResult) {\n                inventoryArray.push(scrapeResult);\n            }).parseInventory();\n        });\n        res.send(inventoryArray);\n    }));\n});\n\nrouter.get('/all', function (req, res, next) {\n    var dbConnection = new _dbOps.dbInterface(\"TBS_Store\");\n    dbConnection.get().then(function (resp) {\n        var stores = resp;\n        var PHA = 4111;\n        var SNPA = 4112;\n        var NHA = 4115;\n        var beers = [PHA, SNPA, NHA];\n        var labels = {\n            4111: \"PHA\",\n            4112: \"SNPA\",\n            4115: \"NHA\"\n        };\n        var arr = [];\n\n        var _loop = function _loop(i) {\n            var store = stores[i];\n            var aggr = {\n                \"store\": store.location\n            };\n            _axios2.default.all(beers.map(function (id) {\n                return _axios2.default.get('http://localhost:3000/api/tbs/inv/' + id + '/' + store.storeid, { data: { id: id } });\n            })).then(_axios2.default.spread(function () {\n                for (var _len2 = arguments.length, results = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n                    results[_key2] = arguments[_key2];\n                }\n\n                for (var n = 0; n < results.length; n++) {\n                    aggr[JSON.parse(results[n].config.data).id] = results[i].data;\n                }\n                arr.push(aggr);\n            }));\n        };\n\n        for (var i = 0; i < stores.length; i++) {\n            _loop(i);\n        }\n    });\n});\n\nexports.default = router;"]}